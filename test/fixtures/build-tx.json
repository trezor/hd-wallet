[
  {
    "description": "builds a simple tx without change",
    "request": {
      "utxos": [
        {
          "index": 0,
          "transactionHash": "b4dc0ffeee",
          "value": 102001,
          "addressPath": [
            3,
            4
          ],
          "height": 100,
          "coinbase": false,
          "tsize": 0,
          "vsize": 0,
          "fee": 0,
          "own": true
        }
      ],
      "outputs": [
        {
          "type": "complete",
          "address": "1BitcoinEaterAddressDontSendf59kuE",
          "amount": 100000
        }
      ],
      "height": 100,
      "feeRate": 10,
      "segwit": false,
      "inputAmounts": false,
      "basePath": [
        44,
        1
      ],
      "changeId": 0,
      "changeAddress": "1CrwjoKxvdbAnPcGzYjpvZ4no4S71neKXT",
      "dustThreshold": 546
    },
    "result": {
      "type": "final",
      "totalSpent": 102001,
      "fee": 2001,
      "feePerByte": 10.261538461538462,
      "max": -1,
      "bytes": 195,
      "transaction": {
        "inputs": [
          {
            "REV_hash": "b4dc0ffeee",
            "index": 0,
            "path": [
              44,
              1,
              3,
              4
            ],
            "segwit": false
          }
        ],
        "PERM_outputs": {
          "permutation": [
            0
          ],
          "sorted": [
            {
              "value": 100000,
              "address": "1BitcoinEaterAddressDontSendf59kuE"
            }
          ]
        }
      }
    }
  },
  {
    "description": "builds an incomplete tx without change",
    "request": {
      "utxos": [
        {
          "index": 0,
          "transactionHash": "b4dc0ffeee",
          "value": 102001,
          "addressPath": [
            3,
            4
          ],
          "height": 100,
          "coinbase": false,
          "tsize": 0,
          "vsize": 0,
          "fee": 0,
          "own": true
        }
      ],
      "outputs": [
        {
          "type": "noaddress",
          "amount": 100000
        }
      ],
      "height": 100,
      "feeRate": 10,
      "segwit": false,
      "inputAmounts": false,
      "basePath": [
        44,
        1
      ],
      "changeId": 0,
      "changeAddress": "1CrwjoKxvdbAnPcGzYjpvZ4no4S71neKXT",
      "dustThreshold": 546
    },
    "result": {
      "type": "nonfinal",
      "totalSpent": 102001,
      "fee": 2001,
      "feePerByte": 10.261538461538462,
      "max": -1,
      "bytes": 195
    }
  },
  {
    "description": "fails on little funds",
    "request": {
      "utxos": [
        {
          "index": 0,
          "transactionHash": "b4dc0ffeee",
          "value": 10,
          "addressPath": [
            3,
            4
          ],
          "height": 100,
          "coinbase": false,
          "tsize": 0,
          "vsize": 0,
          "fee": 0,
          "own": true
        }
      ],
      "outputs": [
        {
          "type": "noaddress",
          "amount": 100000
        }
      ],
      "height": 100,
      "feeRate": 10,
      "segwit": false,
      "inputAmounts": false,
      "basePath": [
        44,
        1
      ],
      "changeId": 0,
      "changeAddress": "1CrwjoKxvdbAnPcGzYjpvZ4no4S71neKXT",
      "dustThreshold": 546
    },
    "result": {
      "type": "error",
      "error": "NOT-ENOUGH-FUNDS"
    }
  },
  {
    "description": "builds a send-max",
    "request": {
      "utxos": [
        {
          "index": 0,
          "transactionHash": "b4dc0ffeee",
          "value": 102001,
          "addressPath": [
            3,
            4
          ],
          "height": 100,
          "coinbase": false,
          "tsize": 0,
          "vsize": 0,
          "fee": 0,
          "own": true
        }
      ],
      "outputs": [
        {
          "type": "send-max",
          "address": "1BitcoinEaterAddressDontSendf59kuE"
        }
      ],
      "height": 100,
      "feeRate": 10,
      "segwit": false,
      "inputAmounts": false,
      "basePath": [
        44,
        1
      ],
      "changeId": 0,
      "changeAddress": "1CrwjoKxvdbAnPcGzYjpvZ4no4S71neKXT",
      "dustThreshold": 546
    },
    "result": {
      "type": "final",
      "totalSpent": 102001,
      "fee": 1950,
      "feePerByte": 10,
      "max": 100051,
      "bytes": 195,
      "transaction": {
        "inputs": [
          {
            "REV_hash": "b4dc0ffeee",
            "index": 0,
            "path": [
              44,
              1,
              3,
              4
            ],
            "segwit": false
          }
        ],
        "PERM_outputs": {
          "permutation": [
            0
          ],
          "sorted": [
            {
              "value": 100051,
              "address": "1BitcoinEaterAddressDontSendf59kuE"
            }
          ]
        }
      }
    }
  }, 
  {
    "description": "fails on weird output type",
    "request": {
      "utxos": [
        {
          "index": 0,
          "transactionHash": "b4dc0ffeee",
          "value": 10,
          "addressPath": [
            3,
            4
          ],
          "height": 100,
          "coinbase": false,
          "tsize": 0,
          "vsize": 0,
          "fee": 0,
          "own": true
        }
      ],
      "outputs": [
        {
          "type": "weird-output-type"
        }
      ],
      "height": 100,
      "feeRate": 10,
      "segwit": false,
      "inputAmounts": false,
      "basePath": [
        44,
        1
      ],
      "changeId": 0,
      "changeAddress": "1CrwjoKxvdbAnPcGzYjpvZ4no4S71neKXT",
      "dustThreshold": 546
    },
    "result": {
      "type": "error",
      "error": "WRONG-OUTPUT-TYPE"
    }
  },
  {
    "description": "fails on empty outputs + utxos input",
    "request": {
      "utxos": [
      ],
      "outputs": [
      ],
      "height": 100,
      "feeRate": 10,
      "segwit": false,
      "inputAmounts": false,
      "basePath": [
        44,
        1
      ],
      "changeId": 0,
      "changeAddress": "1CrwjoKxvdbAnPcGzYjpvZ4no4S71neKXT",
      "dustThreshold": 546
    },
    "result": {
      "type": "error",
      "error": "EMPTY"
    }
  },
  {
    "description": "fails on empty outputs input",
    "request": {
      "utxos": [
        {
          "index": 0,
          "transactionHash": "b4dc0ffeee",
          "value": 102001,
          "addressPath": [
            3,
            4
          ],
          "height": 100,
          "coinbase": false,
          "tsize": 0,
          "vsize": 0,
          "fee": 0,
          "own": true
        }

      ],
      "outputs": [
      ],
      "height": 100,
      "feeRate": 10,
      "segwit": false,
      "inputAmounts": false,
      "basePath": [
        44,
        1
      ],
      "changeId": 0,
      "changeAddress": "1CrwjoKxvdbAnPcGzYjpvZ4no4S71neKXT",
      "dustThreshold": 546
    },
    "result": {
      "type": "error",
      "error": "EMPTY"
    }
  },
  {
    "description": "fails on empty utxos input",
    "request": {
      "utxos": [
      ],
      "outputs": [
        {
          "type": "send-max",
          "address": "1BitcoinEaterAddressDontSendf59kuE"
        }
      ],
      "height": 100,
      "feeRate": 10,
      "segwit": false,
      "inputAmounts": false,
      "basePath": [
        44,
        1
      ],
      "changeId": 0,
      "changeAddress": "1CrwjoKxvdbAnPcGzYjpvZ4no4S71neKXT",
      "dustThreshold": 546
    },
    "result": {
      "type": "error",
      "error": "NOT-ENOUGH-FUNDS"
    }
  },
  {
    "description": "builds a simple tx with two outputs and change",
    "request": {
      "utxos": [
        {
          "index": 0,
          "transactionHash": "b4dc0ffeee",
          "value": 102001,
          "addressPath": [
            3,
            4
          ],
          "height": 100,
          "coinbase": false,
          "tsize": 0,
          "vsize": 0,
          "fee": 0,
          "own": true
        }
      ],
      "outputs": [
        {
          "type": "complete",
          "address": "1BitcoinEaterAddressDontSendf59kuE",
          "amount": 30000
        },
        {
          "type": "complete",
          "address": "1LetUsDestroyBitcoinTogether398Nrg",
          "amount": 20000
        }
      ],
      "height": 100,
      "feeRate": 10,
      "segwit": false,
      "inputAmounts": false,
      "basePath": [
        44,
        1
      ],
      "changeId": 0,
      "changeAddress": "1CrwjoKxvdbAnPcGzYjpvZ4no4S71neKXT",
      "dustThreshold": 546
    },
    "result": {
      "type": "final",
      "totalSpent": 52630,
      "fee": 2630,
      "feePerByte": 10,
      "max": -1,
      "bytes": 263,
      "transaction": {
        "inputs": [
          {
            "REV_hash": "b4dc0ffeee",
            "index": 0,
            "path": [
              44,
              1,
              3,
              4
            ],
            "segwit": false
          }
        ],
        "PERM_outputs": {
          "permutation": [
            1,
            0,
            2
          ],
          "sorted": [
            {
              "value": 20000,
              "address": "1LetUsDestroyBitcoinTogether398Nrg"
            },
            {
              "value": 30000,
              "address": "1BitcoinEaterAddressDontSendf59kuE"
            },
            {
              "path": [
                44,
                1,
                1,
                0
              ],
              "segwit": false,
              "value": 49371
            }
          ]
        }
      }
    }
  }, {
    "description": "builds a simple tx with two outputs and change (segwit)",
    "request": {
      "utxos": [
        {
          "index": 0,
          "transactionHash": "b4dc0ffeee",
          "value": 102001,
          "addressPath": [
            3,
            4
          ],
          "height": 100,
          "coinbase": false,
          "tsize": 0,
          "vsize": 0,
          "fee": 0,
          "own": true
        }
      ],
      "outputs": [
        {
          "type": "complete",
          "address": "1BitcoinEaterAddressDontSendf59kuE",
          "amount": 30000
        },
        {
          "type": "complete",
          "address": "1LetUsDestroyBitcoinTogether398Nrg",
          "amount": 20000
        }
      ],
      "height": 100,
      "feeRate": 10,
      "segwit": true,
      "inputAmounts": true,
      "basePath": [
        44,
        1
      ],
      "changeId": 0,
      "changeAddress": "1CrwjoKxvdbAnPcGzYjpvZ4no4S71neKXT",
      "dustThreshold": 546
    },
    "result": {
      "type": "final",
      "totalSpent": 52050,
      "fee": 2050,
      "feePerByte": 10,
      "max": -1,
      "bytes": 205,
      "transaction": {
        "inputs": [
          {
            "amount": 102001,
            "REV_hash": "b4dc0ffeee",
            "index": 0,
            "path": [
              44,
              1,
              3,
              4
            ],
            "segwit": true
          }
        ],
        "PERM_outputs": {
          "permutation": [
            1,
            0,
            2
          ],
          "sorted": [
            {
              "value": 20000,
              "address": "1LetUsDestroyBitcoinTogether398Nrg"
            },
            {
              "value": 30000,
              "address": "1BitcoinEaterAddressDontSendf59kuE"
            },
            {
              "path": [
                44,
                1,
                1,
                0
              ],
              "segwit": true,
              "value": 49951
            }
          ]
        }
      }
    }
  }, {
    "description": "prefers a more confirmed input",
    "request": {
      "utxos": [
        {
          "index": 1,
          "transactionHash": "b4dc0ffeee",
          "value": 102001,
          "addressPath": [
            3,
            4
          ],
          "height": 100,
          "coinbase": false,
          "tsize": 0,
          "vsize": 0,
          "fee": 0,
          "own": true
        },
        {
          "index": 2,
          "transactionHash": "b4dc0ffeee",
          "value": 102001,
          "addressPath": [
            3,
            4
          ],
          "height": null,
          "coinbase": false,
          "tsize": 0,
          "vsize": 0,
          "fee": 0,
          "own": true
        }
      ],
      "outputs": [
        {
          "type": "complete",
          "address": "1BitcoinEaterAddressDontSendf59kuE",
          "amount": 100000
        }
      ],
      "height": 100,
      "feeRate": 10,
      "segwit": false,
      "inputAmounts": false,
      "basePath": [
        44,
        1
      ],
      "changeId": 0,
      "changeAddress": "1CrwjoKxvdbAnPcGzYjpvZ4no4S71neKXT",
      "dustThreshold": 546
    },
    "result": {
      "type": "final",
      "totalSpent": 102001,
      "fee": 2001,
      "feePerByte": 10.261538461538462,
      "max": -1,
      "bytes": 195,
      "transaction": {
        "inputs": [
          {
            "REV_hash": "b4dc0ffeee",
            "index": 1,
            "path": [
              44,
              1,
              3,
              4
            ],
            "segwit": false
          }
        ],
        "PERM_outputs": {
          "permutation": [
            0
          ],
          "sorted": [
            {
              "value": 100000,
              "address": "1BitcoinEaterAddressDontSendf59kuE"
            }
          ]
        }
      }
    }
  },
  {
    "description": "fails on two send maxes",
    "request": {
      "utxos": [
        {
          "index": 0,
          "transactionHash": "b4dc0ffeee",
          "value": 102001,
          "addressPath": [
            3,
            4
          ],
          "height": 100,
          "coinbase": false,
          "tsize": 0,
          "vsize": 0,
          "fee": 0,
          "own": true
        }
      ],
      "outputs": [
        {
          "type": "send-max",
          "address": "1BitcoinEaterAddressDontSendf59kuE"
        },
        {
          "type": "send-max",
          "address": "1LetUsDestroyBitcoinTogether398Nrg"
        }
      ],
      "height": 100,
      "feeRate": 10,
      "segwit": false,
      "inputAmounts": false,
      "basePath": [
        44,
        1
      ],
      "changeId": 0,
      "changeAddress": "1CrwjoKxvdbAnPcGzYjpvZ4no4S71neKXT",
      "dustThreshold": 546
    },
    "result": {
      "type": "error",
      "error": "TWO-SEND-MAX"
    }
  }, {
    "description": "two inputs",
    "request": {
      "utxos": [
        {
          "index": 1,
          "transactionHash": "b4dc0ffeee",
          "value": 102001,
          "addressPath": [
            3,
            4
          ],
          "height": 100,
          "coinbase": false,
          "tsize": 0,
          "vsize": 0,
          "fee": 0,
          "own": true
        },
        {
          "index": 2,
          "transactionHash": "b4dc0ffeee",
          "value": 102001,
          "addressPath": [
            3,
            4
          ],
          "height": null,
          "coinbase": false,
          "tsize": 0,
          "vsize": 0,
          "fee": 0,
          "own": true
        }
      ],
      "outputs": [
        {
          "type": "complete",
          "address": "1BitcoinEaterAddressDontSendf59kuE",
          "amount": 200000
        }
      ],
      "height": 100,
      "feeRate": 10,
      "segwit": false,
      "inputAmounts": false,
      "basePath": [
        44,
        1
      ],
      "changeId": 0,
      "changeAddress": "1CrwjoKxvdbAnPcGzYjpvZ4no4S71neKXT",
      "dustThreshold": 546
    },
    "result": {
      "type": "final",
      "totalSpent": 204002,
      "fee": 4002,
      "feePerByte": 11.6,
      "max": -1,
      "bytes": 345,
      "transaction": {
        "inputs": [
          {
            "REV_hash": "b4dc0ffeee",
            "index": 1,
            "path": [
              44,
              1,
              3,
              4
            ],
            "segwit": false
          }, {
            "REV_hash": "b4dc0ffeee",
            "index": 2,
            "path": [
              44,
              1,
              3,
              4
            ],
            "segwit": false
          }
        ],
        "PERM_outputs": {
          "permutation": [
            0
          ],
          "sorted": [
            {
              "value": 200000,
              "address": "1BitcoinEaterAddressDontSendf59kuE"
            }
          ]
        }
      }
    }
  }, {
    "description": "builds a simple tx with two same value outputs and change (segwit)",
    "request": {
      "utxos": [
        {
          "index": 0,
          "transactionHash": "b4dc0ffeee",
          "value": 102001,
          "addressPath": [
            3,
            4
          ],
          "height": 100,
          "coinbase": false,
          "tsize": 0,
          "vsize": 0,
          "fee": 0,
          "own": true
        }
      ],
      "outputs": [
        {
          "type": "complete",
          "address": "1BitcoinEaterAddressDontSendf59kuE",
          "amount": 30000
        },
        {
          "type": "complete",
          "address": "1LetUsDestroyBitcoinTogether398Nrg",
          "amount": 30000
        }
      ],
      "height": 100,
      "feeRate": 10,
      "segwit": true,
      "inputAmounts": true,
      "basePath": [
        44,
        1
      ],
      "changeId": 0,
      "changeAddress": "1CrwjoKxvdbAnPcGzYjpvZ4no4S71neKXT",
      "dustThreshold": 546
    },
    "result": {
      "type": "final",
      "totalSpent": 62050,
      "fee": 2050,
      "feePerByte": 10,
      "max": -1,
      "bytes": 205,
      "transaction": {
        "inputs": [
          {
            "amount": 102001,
            "REV_hash": "b4dc0ffeee",
            "index": 0,
            "path": [
              44,
              1,
              3,
              4
            ],
            "segwit": true
          }
        ],
        "PERM_outputs": {
          "permutation": [
            0,
            1,
            2
          ],
          "sorted": [
            {
              "value": 30000,
              "address": "1BitcoinEaterAddressDontSendf59kuE"
            },
            {
              "value": 30000,
              "address": "1LetUsDestroyBitcoinTogether398Nrg"
            },
            {
              "path": [
                44,
                1,
                1,
                0
              ],
              "segwit": true,
              "value": 39951
            }
          ]
        }
      }
    }
  },
  {
    "description": "explicit dust threshold stops change",
    "request": {
      "utxos": [
        {
          "index": 0,
          "transactionHash": "b4dc0ffeee",
          "value": 972463,
          "addressPath": [
            3,
            4
          ],
          "height": 100,
          "coinbase": false,
          "tsize": 0,
          "vsize": 0,
          "fee": 0,
          "own": true
        }
      ],
      "outputs": [
        {
          "type": "complete",
          "address": "1BitcoinEaterAddressDontSendf59kuE",
          "amount": 928960
        }
      ],
      "height": 100,
      "feeRate": 10,
      "segwit": true,
      "inputAmounts": false,
      "basePath": [
        44,
        1
      ],
      "changeId": 0,
      "changeAddress": "1CrwjoKxvdbAnPcGzYjpvZ4no4S71neKXT",
      "dustThreshold": 54600
    },
    "result": {
      "type": "final",
      "totalSpent": 972463,
      "fee": 43503,
      "feePerByte": 317.54014598540147,
      "max": -1,
      "bytes": 137,
      "transaction": {
        "inputs": [
          {
            "REV_hash": "b4dc0ffeee",
            "index": 0,
            "path": [
              44,
              1,
              3,
              4
            ],
            "segwit": true
          }
        ],
        "PERM_outputs": {
          "permutation": [
            0
          ],
          "sorted": [
            {
              "value": 928960,
              "address": "1BitcoinEaterAddressDontSendf59kuE"
            }
          ]
        }
      }
    }
  }
]
